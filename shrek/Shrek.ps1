<#
    .NOTES
        Author: Justin Perdok (@JustinPerdok), https://justin-p.me.
        License: MIT

    .LINK
        https://github.com/justin-p/PowerShell/blob/master/shrek/Shrek.ps1
#>   
$shrek1 = @"

                    _____
                 ,-'     `._                        
               ,'           `.        ,-.           
             ,'               \       ),.\          
   ,.       /                  \     /(  \;         
  /'\\     ,o.        ,ooooo.   \  ,'  `-')         
  )) )`. d8P"Y8.    ,8P"""""Y8.  `'  .--"'          
 (`-'   `Y'  `Y8    dP       `'     /               
  `----.(   __ `    ,' ,---.       (                
         ),--.`.   (  ;,---.        )               
        / \O_,' )   \  \O_,'        |               
       ;  `-- ,'       `---'        |               
       |    -'         `.           |               
      _;    ,            )          :               
   _.'|     `.:._   ,.::" `..       |               
--'   |   .'     """         `      |`.             
      |  :;      :   :     _.       |`.`.-'--.      
      |  ' .     :   :__.,'|/       |  \            
      `     \--.__.-'|_|_|-/        /   )           
       \     \_   `--^"__,'        ,    |           
       ;  `    `--^---'          ,'     |           
        \  `                    /      /            
         \   `    _ _          /                    
          \           `       /                     
           \           '    ,'                      
            `.       ,   _,'                        
              `-.___.---'                           
                                                    
┌─┐┬ ┬┬─┐┌─┐┬┌─  ┬┌─┐  ┬ ┬┌─┐┌┬┐┌─┐┬ ┬┬┌┐┌┌─┐  ┬ ┬┌─┐┬ ┬ 
└─┐├─┤├┬┘├┤ ├┴┐  │└─┐  │││├─┤ │ │  ├─┤│││││ ┬  └┬┘│ ││ │ 
└─┘┴ ┴┴└─└─┘┴ ┴  ┴└─┘  └┴┘┴ ┴ ┴ └─┘┴ ┴┴┘└┘└─┘   ┴ └─┘└─┘o


"@ 
$shrek2 = @"

                    _____
                 ,-'     `._                          
               ,'           `.        ,-.             
             ,'               \       ),.\            
   ,.       /                  \     /(  \;           
  /'\\     ,o.        ,ooooo.   \  ,'  `-')           
  )) )`. d8P"Y8.    ,8P"""""Y8.  `'  .--"'            
 (`-'   `Y'  `Y8    dP       `'     /                 
  `----.(   __ `    ,' ,---.       (                  
         ),--.`.   (  ;,---.        )                 
        / \ O ' )   \  \ O '        |                 
       ;  `-- ,'       `---'        |                 
       |    -'         `.           |                 
      _;    ,            )          :                 
   _.'|     `.:._   ,.::" `..       |                 
--'   |   .'     """         `      |`.               
      |  :;      :   :     _.       |`.`.-'--.        
      |  ' .     :   :__.,'|/       |  \              
      `     \--.__.-'|_|_|-/        /   )             
       \     \_   `--^"__,'        ,    |             
       ;  `    `--^---'          ,'     |             
        \  `                    /      /              
         \   `    _ _          /                      
          \           `       /                       
           \           '    ,'                        
            `.       ,   _,'                          
              `-.___.---'                             

┌─┐┬ ┬┬─┐┌─┐┬┌─  ┬┌─┐  ┬ ┬┌─┐┌┬┐┌─┐┬ ┬┬┌┐┌┌─┐  ┬ ┬┌─┐┬ ┬ 
└─┐├─┤├┬┘├┤ ├┴┐  │└─┐  │││├─┤ │ │  ├─┤│││││ ┬  └┬┘│ ││ │ 
└─┘┴ ┴┴└─└─┘┴ ┴  ┴└─┘  └┴┘┴ ┴ ┴ └─┘┴ ┴┴┘└┘└─┘   ┴ └─┘└─┘o

                                                            
"@                                                          
$shrek3 = @"

                    _____
                 ,-'     `._                                
               ,'           `.        ,-.                   
             ,'               \       ),.\                  
   ,.       /                  \     /(  \;                 
  /'\\     ,o.        ,ooooo.   \  ,'  `-')                 
  )) )`. d8P"Y8.    ,8P"""""Y8.  `'  .--"'                  
 (`-'   `Y'  `Y8    dP       `'     /                       
  `----.(   __ `    ,' ,---.       (                        
         ),--.`.   (  ;,---.        )                       
        / \,_O' )   \  \,_O'        |                       
       ;  `-- ,'       `---'        |                       
       |    -'         `.           |                       
      _;    ,            )          :                       
   _.'|     `.:._   ,.::" `..       |                       
--'   |   .'     """         `      |`.                     
      |  :;      :   :     _.       |`.`.-'--.              
      |  ' .     :   :__.,'|/       |  \                    
      `     \--.__.-'|_|_|-/        /   )                   
       \     \_   `--^"__,'        ,    |                   
       ;  `    `--^---'          ,'     |                   
        \  `                    /      /                    
         \   `    _ _          /                            
          \           `       /                             
           \           '    ,'                              
            `.       ,   _,'                                
              `-.___.---'                                   

┌─┐┬ ┬┬─┐┌─┐┬┌─  ┬┌─┐  ┬ ┬┌─┐┌┬┐┌─┐┬ ┬┬┌┐┌┌─┐  ┬ ┬┌─┐┬ ┬ 
└─┐├─┤├┬┘├┤ ├┴┐  │└─┐  │││├─┤ │ │  ├─┤│││││ ┬  └┬┘│ ││ │ 
└─┘┴ ┴┴└─└─┘┴ ┴  ┴└─┘  └┴┘┴ ┴ ┴ └─┘┴ ┴┴┘└┘└─┘   ┴ └─┘└─┘o 


"@

function Play-Shrek {
  try {
    ## Prepare the screen
    $host.UI.RawUI.BackgroundColor = "Black"
    $host.UI.RawUI.ForegroundColor = "DarkGreen"
    $Host.UI.RawUI.WindowTitle = "GET OUT OF MY SWAMP"
    Clear-Host

    try {
      $host.UI.RawUI.WindowSize = New-Object System.Management.Automation.Host.Size 60, 40
    }
    catch {
      $host.UI.RawUI.BufferSize = New-Object System.Management.Automation.Host.Size 60, 40
    }
    try {
      $host.UI.RawUI.BufferSize = New-Object System.Management.Automation.Host.Size 60, 40
    }
    catch {
      $host.UI.RawUI.BufferSize = New-Object System.Management.Automation.Host.Size 60, 40
    }
    try {
      $host.UI.RawUI.WindowSize = New-Object System.Management.Automation.Host.Size 60, 40
    }
    catch {
      $host.UI.RawUI.BufferSize = New-Object System.Management.Automation.Host.Size 60, 40
    }
    try {
      $host.UI.RawUI.BufferSize = New-Object System.Management.Automation.Host.Size 60, 40
    }
    catch {
      $host.UI.RawUI.BufferSize = New-Object System.Management.Automation.Host.Size 83, 45
    }

    ## Open the background song
    $script = @'
$player = New-Object -ComObject 'MediaPlayer.MediaPlayer'
$player.Open("https://github.com/justin-p/PowerShell/raw/master/shrek/5cHzAAnJbZIk.128.mp3")
$player
'@

    ## ... in a background MTA-threaded PowerShell because
    ## the MediaPlayer COM object doesn't like STA

    $runspace = [RunspaceFactory]::CreateRunspace()
    $runspace.ApartmentState = "MTA"
    $bgPowerShell = [PowerShell]::Create()
    $bgPowerShell.Runspace = $runspace
    $runspace.Open()
    $player = @($bgPowerShell.AddScript($script).Invoke())[0]
    Try {
      ## Wait for it to buffer (or error out)
      while ($true) {
        Start-Sleep -m 500
        if ($player.HasError -or ($player.ReadyState -eq 4)) { break }
      }
      Start-Sleep -m 1600
      Clear-Host
      $host.UI.RawUI.CursorPosition = New-Object System.Management.Automation.Host.Coordinates 0, 0
      while ($true) {
        Write-Output = $shrek1;Start-Sleep -Seconds 1;Clear-Host
        Write-Output = $shrek2;Start-Sleep -Seconds 1;Clear-Host
        Write-Output = $shrek3;Start-Sleep -Seconds 1;Clear-Host
        Write-Output = $shrek2;Start-Sleep -Seconds 1;Clear-Host
      }
    } Catch {

    }
  }
  Finally {
    ## Clean up, display exit screen
    Clear-Host
    "`n"
    "          Happy Scripting from PowerShell"
    "`n`n`n"
    $player.Stop()
    $bgPowerShell.Dispose()
  }
}
Play-Shrek
